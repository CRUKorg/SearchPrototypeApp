!function(global){"use strict";global.app=angular.module("searchPrototypeApp",["ui.router","ngSanitize","elasticsearch","angulartics","angulartics.google.analytics"])}(this),function(){"use strict";app.provider("configurationService",function(){var self=this;self.appSettings={host:"",resultsPerPage:10,strings:{}},"undefined"!=typeof crukSearch&&"undefined"!=typeof crukSearch.config&&angular.merge(self.appSettings,crukSearch.config),self.setSettingValue=function(name,value){self.appSettings[name]=value},self.get=function(){return self.appSettings},self.getSetting=function(key){var setting=self.appSettings;return angular.isString(key)&&(key=[key]),angular.isArray(key)?(angular.forEach(key,function(value){setting=setting[value]}),setting):""},self.set=function(data){self.appSettings=data},self.getString=function(name,values){values=values||{};var regExp=/@(\w*)@/gi;return self.appSettings.strings[name].replace(regExp,function(match){return match=match.replace(/@/gi,""),values[match]})},self.$get=function(){return{appSettings:self.appSettings,get:self.get,set:self.set,getSetting:self.getSetting,setSettingValue:self.setSettingValue,getString:self.getString}}})}(),function(){"use strict";app.filter("highlightmatches",function(){return function(string){return angular.isString(string)?string.split("[mark]").join("<mark>").split("[/mark]").join("</mark>"):string}})}(),function(){"use strict";app.filter("htmlsafe",["$sce",function($sce){return function(string){return $sce.trustAsHtml(string)}}])}(),function(){"use strict";app.filter("plaintext",function(){return function(string){return angular.isString(string)?string.replace(/<(?:.|\n)*?>/gm,""):string}})}(),function(){"use strict";app.filter("trim",function(){return function(string){return angular.isString(string)?"function"!=typeof String.prototype.trim?string.trim():string.replace(/^\s+|\s+$/g,""):string}})}(),function(){"use strict";app.controller("SearchController",["configurationService","ElasticService","esFactory","$log",function(config,ElasticService,esFactory,$log){var self=this;self.searchInput=null,self.lastSearch=null,self.page=1,self.resultsPerPage=config.getSetting("resultsPerPage"),self.error=null,self.results=null,self.searchSubmit=function(searchInput){""!==searchInput&&searchInput!=self.lastSearch&&(self.lastSearch=searchInput,self.executeSearch(searchInput))},self.executeSearch=function(searchInput){self.error=null,ElasticService.search({index:"elasticsearch_index_elasticproto_news",from:(self.page-1)*self.resultsPerPage,size:self.resultsPerPage,body:{query:{multi_match:{type:"phrase",fields:["title","body:value"],query:searchInput}},fields:["title","field_published","field_type","body:value","field_url:url"],highlight:{pre_tags:["[mark]"],post_tags:["[/mark]"],fragment_size:150,number_of_fragments:3,fields:{title:{},"body:value":{}}}}}).then(function(body){$log.log(body),self.error=null,self.page=1,self.results=body.hits.hits},function(error){console.log(error),self.error=error.message,$log.log(error.message)})},self.buildExcerpt=function(fieldData,highlightData){}}])}(),function(){"use strict";app.service("ElasticService",function(esFactory){return esFactory({host:crukSearch.config.host,apiVersion:"2.3",log:"trace"})})}();